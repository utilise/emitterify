var emitterify=function(){"use strict";var n=function(){var n,t,e=new Promise(function(e,r){n=e,t=r});return arguments.length&&n(arguments[0]),e.resolve=n,e.reject=t,e},t=function n(t,e){return e instanceof Array&&(e=e.reduce(n,[])),(t=t||[]).concat(e)},e=function(n,t){return t in n},r=function(n,t,r,o){return n.host&&n.host.nodeName&&(n=n.host),t.name&&(r=t,t=t.name),!e(n,t)&&Object.defineProperty(n,t,{value:r,writable:o}),n[t]},o=function(){};return function e(u,i){function f(n,t){return n.next?n.next(t):t instanceof Array?n.apply(u,t):n.call(u,t)}function c(n,t){for(var e=n.length;~--e;)t!=n[e]&&t!=n[e].fn&&t||(i.off||o)(n.splice(e,1)[0])}function a(t,r){var o=e((r=r||{}).base||n());return o.i=0,o.li=[],o.fn=r.fn,o.parent=t,o.source=r.fn?o.parent.source:o,o.on("stop",function(n){return o.type?o.parent.off(o.type,o):o.parent.off(o),o.reason=n}),o.each=function(n){var t=n.next?n:a(o,{fn:n});return o.li.push(t),t},o.pipe=function(n){return n(o)},o.map=function(n){return o.each(function(t,e,r){return r.next(n(t,e,r))})},o.filter=function(n){return o.each(function(t,e,r){return n(t,e,r)&&r.next(t)})},o.reduce=function(n,t){return o.each(function(e,r,o){return o.next(t=n(t,e,r,o))})},o.unpromise=function(){var n=a(o,{base:{},fn:function(t){return n.next(t)}});return o.li.push(n),n},o.next=function(n){return o.resolve&&o.resolve(n),o.li.length?o.li.map(function(t){return t.fn(n,t.i++,t)}):n},o.until=function(n){return(n.each||n.then).call(n,function(n){return o.source.emit("stop",n)}),o},o.off=function(n){return c(o.li,n),o},o.start=function(){return o.source.emit("start"),o},o[Symbol.asyncIterator]=function(){return{next:function(){return o.wait=new Promise(function(n){o.wait=!0,o.map(function(t,e,r){delete o.wait,o.off(r),n({value:t,done:!1})}),o.emit("pull",o)})}}},o}return u=u||{},i=i||{},r(u,"emit",function(n,e,r){for(var o=u.on[n.split(".")[0]]||[],i=[],c=0;c<o.length;c++)o[c].ns&&r&&!r(o[c].ns)||i.push(f(o[c].isOnce?o.splice(c--,1)[0]:o[c],e));for(c=0;c<u.on["*"].length;c++)i.push(f(u.on["*"][c],[n,e]));return i.reduce(t,[])},1),r(u,"once",function(n,t){return u.on(n,t,!0)},1),r(u,"off",function(n,t){return c(u.on[n]||[],t),t&&t.ns&&delete u.on[n]["$"+t.ns],u},1),r(u,"on",function(n,t,e){function r(n){return n.isOnce=e,n.type=f,s&&(u.on[f]["$"+(n.ns=s)]=n),l.push(n),(i.on||o)(n),n.next?n:u}var f=n.split(".")[0],s=n.split(".")[1],l=u.on[f]=u.on[f]||[],p="function"==typeof t?t:0;return!p&&s?(p=u.on[f]["$"+s])?p:r(a(u,t)):p||s?p&&s?r((c(l,u.on[f]["$"+s]||-1),p)):!(!p||s)&&r(p):r(a(u,t))},1),u.on["*"]=u.on["*"]||[],u}}();