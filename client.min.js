var emitterify=function(){"use strict";var n=function(){var n,t,e=new Promise(function(e,r){n=e,t=r});return arguments.length&&n(arguments[0]),e.resolve=n,e.reject=t,e},t=function n(t,e){return e instanceof Array&&(e=e.reduce(n,[])),(t=t||[]).concat(e)},e=function(n,t){return t in n},r=function(n,t,r,o){return n.host&&n.host.nodeName&&(n=n.host),t.name&&(r=t,t=t.name),!e(n,t)&&Object.defineProperty(n,t,{value:r,writable:o}),n[t]};return function e(o){function u(n,t){return n.next?n.next(t):t instanceof Array?n.apply(o,t):n.call(o,t)}function i(n,t){for(var e=n.length;~--e;)t!=n[e]&&t!=n[e].fn&&t||n.splice(e,1)}function f(t,r){var o=e((r=r||{}).base||n());return o.i=0,o.li=[],o.fn=r.fn,o.parent=t,o.source=r.fn?o.parent.source:o,o.on("stop",function(){return o.type?o.parent.off(o.type,o):o.parent.off(o)}),o.each=function(n){var t=n.next?n:f(o,{fn:n});return o.li.push(t),t},o.pipe=function(n){return n(o)},o.map=function(n){return o.each(function(t,e,r){return r.next(n(t,e,r))})},o.filter=function(n){return o.each(function(t,e,r){return n(t,e,r)&&r.next(t)})},o.reduce=function(n,t){return o.each(function(e,r,o){return o.next(t=n(t,e,r,o))})},o.unpromise=function(){var n=f(o,{base:{},fn:function(t){return n.next(t)}});return o.li.push(n),n},o.next=function(n){return o.resolve&&o.resolve(n),o.li.length?o.li.map(function(t){return t.fn(n,t.i++,t)}):n},o.until=function(n){return n.each(function(){o.source.emit("stop")}),o},o.off=function(n){return i(o.li,n),o},o[Symbol.asyncIterator]=function(){return{next:()=>o.wait=new Promise(n=>{o.wait=!0,o.map((t,e,r)=>{delete o.wait,o.off(r),n({value:t,done:!1})}),o.emit("pull",o)})}},o}return o=o||{},r(o,"emit",function(n,e,r){for(var i=o.on[n.split(".")[0]]||[],f=[],c=0;c<i.length;c++)i[c].ns&&r&&!r(i[c].ns)||f.push(u(i[c].isOnce?i.splice(c--,1)[0]:i[c],e));for(c=0;c<o.on["*"].length;c++)f.push(u(o.on["*"][c],[n,e]));return f.reduce(t,[])},1),r(o,"once",function(n,t){return o.on(n,t,!0)},1),r(o,"off",function(n,t){return i(o.on[n]||[],t),t&&t.ns&&delete o.on[n]["$"+t.ns],o},1),r(o,"on",function(n,t,e){function r(n){return n.isOnce=e,n.type=u,c&&(o.on[u]["$"+(n.ns=c)]=n),a.push(n),n.next?n:o}var u=n.split(".")[0],c=n.split(".")[1],a=o.on[u]=o.on[u]||[],s="function"==typeof t?t:0;return!s&&c?(s=o.on[u]["$"+c])?s:r(f(o,t)):s||c?s&&c?r((i(a,o.on[u]["$"+c]||-1),s)):!(!s||c)&&r(s):r(f(o,t))},1),o.on["*"]=o.on["*"]||[],o}}();